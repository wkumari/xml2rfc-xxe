<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id$ -->
<!DOCTYPE article PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
"http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<article>
  <title>xml2rfc Plugin</title>

  <articleinfo>
    <author>
      <firstname>Bill</firstname>

      <surname>Fenner</surname>

      <email>fenner@research.att.com</email>
    </author>

    <abstract>
      <para>xml2rfc/rfc2629 support for the XMLMind XML Editor.</para>

      <para>Great thanks are due to Hussein Shafie, who answered many
      inexperienced questions about xxe's css/xml/java support.</para>
    </abstract>

    <pubdate role="rcs">$Date$</pubdate>
  </articleinfo>

  <section>
    <title>Overview</title>

    <para>This xxe plugin attempts to support most of the rfc2629bis DTD, as
    of xml2rfc release 1.28, January 16, 2005. This documentation is
    $Revision$, and tries to document plugin version %%VERSION%%. The
    plugin requires at least xxe 2.8p1 (released November 29, 2004).</para>

    <para>This plugin can create text or HTML output using xml2rfc, if
    installed; it can also use xmlmind's native XSL support to generate HTML.
    Use the menu items "Convert to HTML using XSL" and "HTML Preview using
    XSL" if you don't have xml2rfc installed.</para>

    <para>The following items are not yet (and may never be) supported:</para>

    <itemizedlist>
      <listitem>
        <para>texttable. This requires some extra help (probably a custom java
        widget) to style the table for xmlmind.</para>
      </listitem>

      <listitem>
        <para>&lt;?rfc ?&gt; processing instructions in general. &lt;?rfc
        include= in particular. (Wish: to be able to handle this like external
        entity references) (Partial &lt;?rfc include= support is described in
        <xref linkend="extref" />).</para>
      </listitem>

      <listitem>
        <para>The RFC's description of &lt;list&gt; specifies that style is
        inherited from nearest parent; DTD says that it defaults to empty. The
        editor currently uses the DTD definition; java might be able to help
        implement the other way.</para>
      </listitem>

      <listitem>
        <para>&lt;list style="format"&gt;</para>
      </listitem>

      <listitem>
        <para>&lt;list counter&gt;</para>
      </listitem>
    </itemizedlist>

    <para>Planned features:</para>

    <itemizedlist>
      <listitem>
        <para>Make toolbar helpers more useful</para>

        <itemizedlist>
          <listitem>
            <para>Increase/decrease list item level</para>
          </listitem>
        </itemizedlist>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Usage</title>

    <para>For now, you still have to know a fair amount about the xml2rfc
    schema to use this tool.</para>

    <para>Enter and backspace can be used as you might expect a word processor
    to behave when you're editing paragraphs or lists.</para>

    <para>To insert sections, paragraphs, figures, cross-references, etc., use
    the toolbar or the XXE insert pane; you'll commonly use "Insert" and
    "Insert After".</para>

    <para>Lists, paragraphs and sections are inserted after/inside the current
    one depending on the XXE selection; generally a new element is inserted
    after the current one if the current one is selected, or at the easiest
    place inside the current one if the mark is inside the current
    element.</para>

    <section>
      <title>Toolbar</title>

      <para>Most toolbar items that add elements have behavior that depends on
      the currently selected object. In general, if the selected object is an
      element, the item that's added is a sibling to the selected object. If
      the selection is simply text or there is no selection and the cursor is
      in text, the item that's added is added at or as close to the cursor as
      is feasible, generally as a child of the parent item.</para>

      <variablelist>
        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/itemizedlist.gif" />
              </imageobject>
            </inlinemediaobject>Add Itemized List</term>

          <listitem>
            <para>Adds an itemized list (<literal>&lt;list
            style="symbols"&gt;</literal>)</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/orderedlist.gif" />
              </imageobject>
            </inlinemediaobject>Add Ordered List</term>

          <listitem>
            <para>Adds an ordered list (<literal>&lt;list
            style="numbers"&gt;</literal>)</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/list_menu.gif" />
              </imageobject>
            </inlinemediaobject>Add other list</term>

          <listitem>
            <para></para>

            <variablelist>
              <varlistentry>
                <term>empty</term>

                <listitem>
                  <para>Adds an empty list (<literal>&lt;list
                  style="empty"&gt;</literal>)</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>letters</term>

                <listitem>
                  <para>Adds a lettered list (<literal>&lt;list
                  style="letters"&gt;</literal>)</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>hanging text</term>

                <listitem>
                  <para>Adds a list using hanging text (<literal>&lt;list
                  style="hanging"&gt;</literal>)</para>
                </listitem>
              </varlistentry>
            </variablelist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/para.gif" />
              </imageobject>
            </inlinemediaobject>Add paragraph or list item</term>

          <listitem>
            <para>Add a paragraph or list item at the current level.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/section.gif" />
              </imageobject>
            </inlinemediaobject>Add section</term>

          <listitem>
            <para>Add a section - if a section is currently selected, add a
            sibling at the same level; otherwise, add a subsection within the
            current section.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/decrsectlevel.gif" />
              </imageobject>
            </inlinemediaobject>Decrease section level</term>

          <listitem>
            <para>Decrease the indentation of the explicitly selected section,
            by making it a sibling of its parent. (e.g., turns 3.2.1 into 3.3
            and if there was a 3.3 it becomes 3.4)</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/incrsectlevel.gif" />
              </imageobject>
            </inlinemediaobject>Increase section level</term>

          <listitem>
            <para>Increases the indentation of the explicitly selected
            section, by creating an empty section inside which to enclose it.
            Note that this never undoes the effect of the decrease
            function.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/table.gif" />
              </imageobject>
            </inlinemediaobject>Add table</term>

          <listitem>
            <para>Adds a &lt;texttable&gt; and related elements.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/figure.gif" />
              </imageobject>
            </inlinemediaobject>Add figure</term>

          <listitem>
            <para>Adds a &lt;figure&gt; and related elements.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/navigate2.gif" />
              </imageobject>
            </inlinemediaobject>Swap xref ends</term>

          <listitem>
            <para>Flips back and forth between an xref and its target. When
            going from the target back to xref, this flips to the first
            reference to that target in the document; see the next two
            commands.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/navigatePrevious2.gif" />
              </imageobject>
            </inlinemediaobject>Previous xref to same target</term>

          <listitem>
            <para>If there is another xref to the same target earlier in this
            document, go to it.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/navigateNext2.gif" />
              </imageobject>
            </inlinemediaobject>Next xref to same target</term>

          <listitem>
            <para>If there is another xref to the same target later in this
            document, go to it.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/emphasis_menu.gif" />
              </imageobject>
            </inlinemediaobject>Convert to emphasis (spanx)</term>

          <listitem>
            <para>Convert the selected text to the selected type of
            emphasis.</para>

            <variablelist>
              <varlistentry>
                <term>emph</term>

                <listitem>
                  <para>Emphasis - usually <emphasis>italic</emphasis> or
                  *emphasized*</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>strong</term>

                <listitem>
                  <para>Strong - usually <emphasis role="bold">bold</emphasis>
                  or 'single-quoted'</para>
                </listitem>
              </varlistentry>

              <varlistentry>
                <term>verb</term>

                <listitem>
                  <para>Verbatim - usually <literal>monospaced</literal> or
                  "quoted"</para>
                </listitem>
              </varlistentry>
            </variablelist>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><inlinemediaobject>
              <imageobject>
                <imagedata fileref="icons/plain.gif" />
              </imageobject>
            </inlinemediaobject>Convert to plain text</term>

          <listitem>
            <para>Converts the selection to plain text. In general, removes
            any formatting elements around the selection but doesn't lose any
            text. This has the expected results when applied to a
            <literal>&lt;spanx&gt;</literal> and possibly unexpected results
            when applied to a figure, table or list.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section>
    <title>XML2RFC menu</title>

    <variablelist>
      <varlistentry>
        <term>HTML Preview</term>

        <listitem>
          <para>Uses an externally-installed <literal>xml2html</literal> to
          convert the XML to HTML, then opens up the rendered HTML in a web
          browser.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Text Preview</term>

        <listitem>
          <para>Uses an externally-installed <literal>xml2rfc</literal> to
          convert the XML to text, then opens up a text editor (or an xterm
          running less) on the result.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>HTML Preview using XSL</term>

        <listitem>
          <para>Uses Julian Reschke's xsl transform to convert the XML to
          HTML, then opens up the rendered HTML in a web browser. This
          procedure does not require any external software, so should work on
          any system even without the xml2rfc tool installed.</para>
        </listitem>
      </varlistentry>
    </variablelist>

    <section>
      <title>Convert sub-menu</title>

      <variablelist>
        <varlistentry>
          <term>Convert to HTML</term>

          <listitem>
            <para>Asks for the file to save the result in; then uses an
            externally-installed <literal>xml2html</literal> to convert the
            XML to HTML.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Convert to Text</term>

          <listitem>
            <para>Asks for the file to save the result in; then uses an
            externally-installed <literal>xml2rfc</literal> to convert the XML
            to text.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Convert to HTML using XSL</term>

          <listitem>
            <para>Asks for the file to save the result in; then uses Julian
            Reschke's XSL transform to convert the XML to HTML.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>Convert to PDF using XSL</term>

          <listitem>
            <para>NOTE: This procedure requires xxe Professional Edition; the
            FO plugins are not supported in Standard Edition.</para>

            <para>Asks for the file to save the result in; then uses Julian
            Reschke's XSL transform to convert the XML to XML-FO, then uses an
            xxe XML-FO plugin (if installed) to convert the FO to PDF.</para>
          </listitem>
        </varlistentry>
      </variablelist>
    </section>
  </section>

  <section>
    <title>Table Rendering</title>

    <para>The xml2rfc &lt;texttable&gt; attribute is basically unsupported at
    this time. xxe has native table support, but requires row elements to wrap
    sets of cells; there is no straightforward way at this time to support the
    xml2rfc schema's type of table that just has a series of cells with no row
    elements.</para>
  </section>

  <section>
    <title>Processing Instructions</title>

    <para>Although support for editing and inserting &lt;?rfc include=?&gt;
    processing instructions more easily is planned, support for handling the
    file that is included is not - meaning that, for example, although
    cross-references to a reference in the included file now show as
    "included", the xxe validator will claim that the document doesn't
    validate.</para>

    <para>xxe is by nature a "root element editor", not an XML file editor, so
    at this time has no ability to edit processing instructions that occur
    before the root &lt;rfc&gt; element. This plugin displays these elements
    in the "RFC meta-data" section at the top, but editing support is not
    planned.</para>
  </section>

  <section>
    <title id="extref">Including External References</title>

    <para>There are two commonly-used methods of importing references from the
    reference database maintained at xml.resource.org:</para>

    <itemizedlist>
      <listitem>
        <para><emphasis role="bold">Entity definitions and
        references.</emphasis> This is the form shown under "Including files"
        on the xml.resource.org web page. Definitions are of the
        form<literallayout>&lt;DOCTYPE rfc SYSTEM 'rfc2629.dtd' [
 &lt;!ENTITY rfc2629 PUBLIC '' 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2629.xml'&gt;
]&gt;</literallayout><literal>xxe</literal> understands these references when
        loading the file, and also loads the referenced file read-only; this
        makes the document validate and allows the cross-reference macros to
        save it. Unfortunately, when xxe saves the document, it turns the
        entity definition into the equivalent:<literallayout>&lt;DOCTYPE rfc SYSTEM 'rfc2629.dtd' [
 &lt;!ENTITY rfc2629 SYSTEM 'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2629.xml'&gt;
]&gt;</literallayout>When <literal>xml2rfc</literal> (at least, up to and
        including version 1.26) reads this, it looks for a relative reference
        - it only handles fully-qualified URLs in PUBLIC entity definitions,
        so it cannot format a file that has been edited this way. (This is a
        bug in xml2rfc; the two entity definitions above are
        equivalent.)</para>

        <para>In addition, <literal>xxe</literal> doesn't support inserting
        entity definitions or references into the document, so these must be
        done using another editor.</para>
      </listitem>

      <listitem>
        <para><emphasis role="bold">&lt;?rfc include="..."?&gt; processing
        instructions.</emphasis> These are described in the README for
        <literal>xml2rfc</literal>. They only require a single processing
        instruction inserted where the reference belongs, e.g.:<literallayout>&lt;?rfc include="reference.RFC.2629.xml"?&gt;</literallayout>However,
        this does not cause <literal>xxe</literal> to load the reference, so
        it may think that the document is not well-formed (e.g., a
        &lt;references&gt; section with no &lt;reference&gt; elements since
        they're all included). xxe will also refuse to allow you to delete an
        element that makes the document not-well-formed, so you may end up
        with a placehodler &lt;reference&gt; inside a references section that
        you have to delete by editing the .xml file elsewhere. The
        &lt;xref&gt;-checking code does check for the standard naming
        convention, so an xref to "RFC2629" will show as "included" given the
        above processing instruction.</para>

        <para>To insert a processing instruction, use F6 or select the Insert
        &lt;?rfc include=''?&gt; menu item in the XML2RFC menu. This will
        insert an &lt;?rfc include=''?&gt; processing instruction inside or
        after the currently-selected element.</para>

        <para>The XSL transforms will process &lt;?rfc include=''?&gt;
        instructions. They default to using the xml.resource.org site; if you
        have a local mirror you can configure it as follows:</para>

        <orderedlist>
          <listitem>
            <para>Create a file "my_xml2rfc_catalog.xml" in your XXE
            configuration directory (the same place you unzipped the xml2rfc
            plugin, in the config/ directory)</para>
          </listitem>

          <listitem>
            <para>Add the following two lines:</para>

            <para><literallayout>  &lt;rewriteURI uriStartString="xml2rfc-bibxml:"
              rewritePrefix="(URL to your RFC bibxml mirror)" /&gt;
  &lt;rewriteURI uriStartString="xml2rfc-bibxml3:"
              rewritePrefix="(URL to your I-D bibxml mirror)" /&gt;
</literallayout></para>
          </listitem>
        </orderedlist>

        <para>Future work will hopefully teach xxe about this style of
        inclusion so that it can include the actual referenced file read-only.
        (xxe knows how to do this with entities and xi:include)</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Known Limitations</title>

    <para></para>

    <itemizedlist>
      <listitem>
        <para>Pasting from the ASCII art editor JavE (at least on MacOS)
        produces a garbled figure. This is fixed in xxe after 2.8p1.</para>
      </listitem>

      <listitem>
        <para>The 27th lettered list element is "a0", not "aa". This is fixed
        in xxe after 2.8p1.</para>
      </listitem>

      <listitem>
        <para>xml2rfc version 1.26 and earlier cannot load &lt;ENTITY SYSTEM
        "http://..."&gt; definitions; xxe will change the &lt;ENTITY PUBLIC ""
        "http://..."&gt; format that xml2rfc understands to the SYSTEM one.
        This is fixed in xml2rfc version 1.27.</para>
      </listitem>
    </itemizedlist>
  </section>

  <section>
    <title>Support</title>

    <para>Support for this plugin is available via the
    xml2rfc-xxe@rtg.ietf.org mailing list. See
    http://rtg.ietf.org/mailman/listinfo/xml2rfc-xxe for more info. The
    distribution page is http://rtg.ietf.org/~fenner/ietf/xml2rfc-xxe/ . A
    bug/issue list is
    http://rtg.ietf.org/Members/BillFenner/xml2rfc-xxe/</para>
  </section>

  <section>
    <?dbhtml filename="ChangeLog.html"?>

    <title>Change Log</title>

    <variablelist>
      <varlistentry>
        <term>0.4 - Jan 28, 2005</term>

        <listitem>
          <itemizedlist>
            <listitem>
              <para>&lt;artwork&gt; is now always saved as [CDATA[..]] to
              assist external editing and ensure whitespace
              preservation.</para>
            </listitem>

            <listitem>
              <para>The anchor of a &lt;reference&gt; that's not referenced in
              the document turns red.</para>
            </listitem>

            <listitem>
              <para>&lt;?rfc include...?&gt; is now handled when using XSL for
              preview or conversion (thanks to Rob Austein / ISC for the
              script). [to do: document configuring the local directory with a
              catalog]</para>
            </listitem>

            <listitem>
              <para>Changed HTML preview using xml2html to a process just like
              the one using xml2rfc - no longer strips out processing
              instructions.</para>
            </listitem>

            <listitem>
              <para>Updated XSL transforms to Julian's January 27, 2005
              release.</para>
            </listitem>

            <listitem>
              <para>Added F6/menu option to insert an &lt;?rfc include=''?&gt;
              PI</para>
            </listitem>

            <listitem>
              <para>Added command-ENTER and command-shift-ENTER shortcuts to
              insert the same element after (before) the current one.</para>
            </listitem>

            <listitem>
              <para>Duplicate anchors are noted with [DUPLICATE ANCHOR] in
              red.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>0.3 - Dec 17, 2004</term>

        <listitem>
          <itemizedlist>
            <listitem>
              <para>Switched to file picker, not directory picker, for the
              results of conversions.</para>
            </listitem>

            <listitem>
              <para>Added increase/decrease section level with xxe's
              builtins.</para>
            </listitem>

            <listitem>
              <para>Added link end swaps</para>
            </listitem>

            <listitem>
              <para>PDF renderer via FOP verified to work (using the config
              distributed with 0.2). This requires xxe Professional
              Edition.</para>
            </listitem>

            <listitem>
              <para>Display "included" after an xref that seems to refer to an
              &lt;?rfc include=...?&gt;ed reference. This match triggers if a)
              the target= starts with RFC and the processing instruction
              includes "reference.RFC.N", or b) the target= starts with RFC
              and the processing instruction includes
              "reference.&lt;target&gt;". Boy did that make for a complex
              xpath function.</para>
            </listitem>

            <listitem>
              <para>Display the actual rfc processing instructions that occur
              before the root element.</para>
            </listitem>

            <listitem>
              <para>Display "[not referenced]" next to an anchor that has no
              references (most significant in a references section)</para>
            </listitem>

            <listitem>
              <para>Display the format string (unformatted) in format-style
              lists.</para>
            </listitem>

            <listitem>
              <para>Claim (inside xxe) an XML document with no DOCTYPE and an
              &lt;rfc&gt; root element, and force the rfc2629.dtd on it. Also
              claim &lt;reference&gt;, in case of editing a reference that's
              included via an entity reference.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>0.2 - Nov 29, 2004</term>

        <listitem>
          <itemizedlist>
            <listitem>
              <para>Fixed section and appendix numbering, make a note when we
              know we can't auto-number properly because the indentation got
              too deep.</para>
            </listitem>

            <listitem>
              <para>Modified comment and figure coloring to match XSL
              transform's HTML output</para>
            </listitem>

            <listitem>
              <para>Support hangIndent in hanging lists</para>
            </listitem>

            <listitem>
              <para>Make hangText editable in the margin in hanging
              lists</para>
            </listitem>

            <listitem>
              <para>Note in the figure handle if the document uses the
              deprecated &lt;t&gt;&lt;figure&gt; construct.</para>
            </listitem>

            <listitem>
              <para>Slightly modify texttable rendering to give the preamble
              and postamble a consistent look. (Still can't render the body of
              the table as a table)</para>
            </listitem>

            <listitem>
              <para>Display "???" as the marker for lists with an invalid
              style</para>
            </listitem>

            <listitem>
              <para>Display warning inside &lt;list&gt; that's not a child of
              &lt;t&gt;</para>
            </listitem>

            <listitem>
              <para>Fixed bugs in draft template; it validates now</para>
            </listitem>

            <listitem>
              <para>Include online help</para>
            </listitem>

            <listitem>
              <para>XSL HTML preview and HTML and (untested) PDF
              conversions</para>
            </listitem>

            <listitem>
              <para>Add template to ensure that added references contain all
              required elements.</para>
            </listitem>
          </itemizedlist>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>0.1 - Nov 17, 2004</term>

        <listitem>
          <para>First public release</para>
        </listitem>
      </varlistentry>
    </variablelist>
  </section>
</article>